<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en-US ">

<head>

	<title>Shopping Cart</title>

	<link rel="shortcut icon" href="img/TSR_favicon.ico">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<meta name="description"
		content="We sell fried chicken, burgers, and sometimes a lovely brew of coffee." />
	<meta name="image" content="img/TSR_backdrop.png" />

	<meta property="og:site_name" content="The Silk Road - Culinary Delight" />
	<meta property="og:type" content="website" />
	<meta name="twitter:card" content="summary_large_image" />

	<meta name="title" content="Main Page">
	<meta property="og:title" content="Main Page" />
	<meta name="twitter:title" content="Main Page" />
	<meta property="og:description"
		content="We sell fried chicken, burgers, and sometimes a lovely brew of coffee." />
	<meta name="twitter:description"
		content="We sell fried chicken, burgers, and sometimes a lovely brew of coffee." />

	<meta property="og:image:width" content="381" />
	<meta property="og:image:height" content="200" />
	<meta property="og:image" content="img/TSR_backdrop.png" />
	<meta name="twitter:image" content="img/TSR_backdrop.png" />

	<meta name="og:url" content="https://the-silk-road.azurewebsites.net" />
	<meta name="theme-color" content="#FFEF00">

	<meta name="keywords" content="uccd2223 assignment may 2020">
	<meta name="author" content="Sammy, Yamamoo, Ernest">
	<meta name="copyright" content="Cytokine Corporations">
	<meta name="robots" content="index, follow">
	<meta http-equiv="content-type" content="text/html;UTF-8">
	<meta http-equiv="content-language" content="en">
	<meta name="og:locale" content="en_US" />
	<meta charset="utf-8">

	<!-- Schema.org for Google -->
	<meta itemprop="name" content="The Silk Road">
	<meta itemprop="description"
		content="We sell fried chicken, burgers, and sometimes a lovely brew of coffee." />
	<meta itemprop="image" content="img/TSR_backdrop.png" />

	<!-- External Files and Plugins -->
	<link rel="stylesheet" href="//cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css">
	<link rel="stylesheet" href="css/index.css" />
	<script src="js/jquery-3.5.1.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
		integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous">
	</script>
	<script src="js/bootstrap.js"></script>
	<script src="js/holder.js"></script>

	<!-- Google Login API -->
	<script src="https://apis.google.com/js/platform.js" async defer></script>
	<script src="js/googleAPI.js"></script>
	<meta name="google-signin-client_id"
		content="505338635145-6s54bgd0oieh9rgmr9tev016255i8t38.apps.googleusercontent.com">

	<style>

		#clearModal button, #clearSelectModal button{
			width: 5rem;
		}
		@media (max-width: 992px){
			#deleteWrapper button{
				width: 100%;
			}
		}
	
	</style>


</head>

<body class="d-flex flex-column min-vh-100">

	<!-- CSS Bootstrap Theme -->
	<link id="csstheme" rel="stylesheet" property="stylesheet" href="css/bootstrap-darkly.css">

	<nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
		<a class="navbar-brand" href="index.html">
			<img src="img/TSR_favicon.ico" width="30" height="30" class="d-inline-block align-top" alt="logo">
			The Silk Road
		</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
			aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNavDropdown">
			<ul class="navbar-nav mr-auto mt-2 mt-lg-0">
				<li class="nav-item">
					<a class="nav-link" href="index.html">Home</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="menu.html">Menu</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="about.html">About</a>
				</li>
			</ul>
			<hr>
			<div id="infoWrapper">
				<span id="textWrapper" class="text-light text-white-50">
					Welcome, <span id="userName">Username Here</span>
				</span>
				<img id="userImg" class="rounded-circle border border-success" data-toggle="modal"
					data-target="#UserDetailsModal" src="img/test.png"" alt="User Image">
			</div>
			<div id="cartWrapper" class="d-flex flex-row justify-content-center align-items-center">
				<a id="userCart" class="mdi mdi-cart-outline" href="cart.html"></a>
				<span id="cartNumber" class="badge badge-pill badge-primary">0</span>
			</div>
			<div id="gSignInWrapper" class="g-signin2" data-width="GBtnWidth" data-theme="dark" data-onsuccess="onSignIn"></div>
			<div id="navtheme" class="nav-item dropdown">
				<button id="navthemeBtn" class="btn btn-block btn-primary nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false">
					Theme
				</button>
				<div id="navdropdown" class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
					<a class="dropdown-item" href="#" id="style01"">Darkly</a>
					<a class=" dropdown-item" href="#" id="style02"">United</a>
					<a class=" dropdown-item" href="#" id="style03"">Solar</a>
					<a class=" dropdown-item" href="#" id="style04"">Vanilla</a>
				</div>
			</div>
		</div>
	</nav>

	<!-- User Details Modal -->
	<div class="modal fade" id="UserDetailsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModal3Label"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModal3Label">User Details</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="media">
						<img id="modalImg" class="rounded-circle border border-warning d-flex align-self-start mr-3"
							src="" alt="User Image">
						<div class="media-body">
							<span id="modalID" class="text-break badge badge-warning">ID Here</span>
							<h5 id="modalName" class="text-break mt-0">Username Here </h5>
							<p id="modalEmail" class="text-break">Email Here</p>
							<lead>ID Token</lead>
							<p id="modalToken" class="overflow-auto border border-secondary p-2 text-break text-monospace d-inline-block" style="height: 15rem;">
								<small>
									ID Token Here aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
								</small>
							</p>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<button id="btnSignOut" type="button" class="btn btn-primary" onclick="signOut();">Sign out</a>
				</div>
			</div>
		</div>
	</div>

	<div id="tableWrapper" class="card mb-5 ml-3 mr-3 mb-3 p-2" style="margin-top:4.5rem;">
		<h3 class="card-title"><span class="mdi mdi-cart-outline mr-1" style="font-size:2.2rem"></span>Shopping Cart</h3>
		<div class="alert alert-warning" role="alert">
			<strong><span class="mdi mdi-alert-circle mr-1" style="font-size:1.25rem"></span>Remember!</strong> Cart items will be cleared upon leaving the session or signing out.
		</div>
		<div class="table-responsive">
			<table class="table table-striped">
				<thead class="thead-dark">
					<tr>
						<th>#</th>
						<th>Food Item</th>
						<th>Single Price</th>
						<th>Item Count</th>
						<th>Stack Price</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div id="deleteWrapper">
			<button id="btnPayment" type="button" class="btn btn-primary m-1">Place Order</button>
			<button id="btnChecked" type="button" class=" btn btn-warning m-1" data-toggle="modal"
				data-target="#clearSelectModal" disabled>Clear Selected</button>
			<button id="btnClear" type="button" class=" btn btn-danger m-1" data-toggle="modal" data-target="#clearModal" >Clear All Items</button>
			
		</div>
		<div id="emptyTable" class="text-center">
			<h4>It looks like your cart is empty, order something!</h4>
		</div>
	</div>

	<!-- Clear All Confirm Modal -->
	<div class="modal" id="clearModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel1"
	aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="modalLabel1">Confirmation - Clear All</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				Confirm delete all cart items?
			</div>
			<div class="modal-footer">
				<button type="button" class="mr-auto btn btn-secondary" data-dismiss="modal">No</button>
				<button id="btnClearYes" type="button" class=" btn btn-primary">Yes</button>
			</div>
		</div>
	</div>
	</div>

	<!-- Clear Selected Confirm Modal -->
	<div class="modal" id="clearSelectModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel2"
	aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="modalLabel2">Confirmation - Remove Selected</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				Confirm delete all selected cart items?
			</div>
			<div class="modal-footer">
				<button type="button" class="mr-auto btn btn-secondary" data-dismiss="modal">No</button>
				<button id="btnCheckedYes" type="button" class=" btn btn-primary">Yes</button>
			</div>
		</div>
	</div>
	</div>

	<div id="gform" class="g-form card m-3 p-2" style="display: none;">
		<h3 class="card-title"><span class="mdi mdi-chart-arc mr-1" style="font-size:2.2rem"></span>Order Form</h3>
		<h5>Order Code: <span id="code"></span></h5>
		<div class="alert alert-secondary" role="alert">
			<span class="mdi mdi-check-circle-outline mr-1"></span>
			The code above will help us prepare your order. Please paste this code in the Google form below.
		</div>
		<iframe src="https://docs.google.com/forms/d/e/1FAIpQLSfPB3-xxhtYH5ACCEhvmsogEx2HyIsq1P9zIYQr5vpZyNpj7g/viewform?embedded=true" width="100%" height="720" frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe>
	</div>

	<footer class="mt-auto bg-dark">
		<div class="container-fluid pt-2 text-white">
			<div class="row">
				<div class="col">
					<div class="text-center">
						<p>All Rights Reserved &copy 2020</p>
					</div>
				</div>
			</div>
		</div>
	</footer>

	<script src ="js/app.js"></script>
	<script src="js/cart.js"></script>
	<script>

		$(document).ready(function(){

			// Testing
			// sessionStorage.setItem("cartItems",JSON.stringify({"1001":["Nashville Hot Chicken","13.50",1],"1002":["Honey Garlic Karaage","12.00",1],"2002":["White Castle Sliders","15.60",1],"3001":["Mocha","7.50",3]}));

			var record = JSON.parse(sessionStorage.getItem("cartItems"));
			
			//Default Action on Cart Page
			if(record != null){
				$("#emptyTable").hide();
				$("#deleteWrapper").show();
				var index = 0;
				var sumPrice = 0;
				var sumItem = 0;

				// for(x in record){
				// 	$("#tableWrapper table tbody").append(
				// 		`<tr class="">
				// 		<td>
				// 			<div class="custom-control custom-checkbox">
				// 				<input id="checkbox${index+1}" type="checkbox" class="custom-control-input" value="${x}">
				// 				<label class="custom-control-label" for="checkbox${index+1}"></label>
				// 			</div>
				// 		</td>
				// 		<td>
				// 			${record[x][0]}
				// 		</td>
				// 		<td>
				// 			${parseFloat(record[x][1]).toFixed(2)}
				// 		</td>
				// 		<td>
				// 			${parseInt(record[x][2])}
				// 		</td>
				// 		<td>
				// 			${(parseFloat(record[x][2])*parseFloat(record[x][1]).toFixed(2)).toFixed(2)}
				// 		</td>
				// 		</tr>`
				// 	)
				// 	index++;
				// 	sumPrice += parseFloat(record[x][2])*parseFloat(record[x][1]);
				// 	sumItem += parseInt(record[x][2]);
				// }

				for(let i = 0; i < record.length; i++){
				$("#tableWrapper table tbody").append(
				`<tr class="">
					<td>
						<div class="custom-control custom-checkbox">
							<input id="checkbox${index+1}" type="checkbox" class="custom-control-input" value="${record[i].id}">
							<label class="custom-control-label" for="checkbox${index+1}"></label>
						</div>
					</td>
					<td>
						${record[i].name}
					</td>
					<td>
						${parseFloat(record[i].price).toFixed(2)}
					</td>
					<td>
						${parseInt(record[i].count)}
					</td>
					<td>
						${(parseFloat(record[i].count)*parseFloat(record[i].price).toFixed(2)).toFixed(2)}
					</td>
				</tr>`
				)
				index++;
				sumPrice += parseFloat(record[i].count)*parseFloat(record[i].price);
				sumItem += parseInt(record[i].count);
				}

				$("#tableWrapper table tbody").append(
					`<tr class="table-info">
						<td></td>
						<td></td>
						<td>Total</td>
						<td>
							${sumItem}
						</td>
						<td>
							${sumPrice.toFixed(2)}
						</td>
					</tr>`
				);
				
				//Delete Checking Function
				var delMatch;
				countChecked();

				$( "#tableWrapper input[type=checkbox]" ).on( "click", ()=>{
					$( "#tableWrapper input" ).parent().parent().parent().removeClass("table-danger");
					countChecked();
				} );

				function countChecked() {
					var delData = {};
					$( "#tableWrapper input:checked" ).parent().parent().parent().addClass("table-danger");
					for(let i = 0; i < $( "#tableWrapper input:checked" ).length; i++){ 
						delData[i] = $( "#tableWrapper input:checked" )[i].attributes[3].nodeValue;
					}

					delMatch = JSON.stringify(delData);

					if(delMatch.length == 2 ){
						$("#btnChecked").prop("disabled",true);
					}else{
						$("#btnChecked").prop("disabled",false);
					}
				}; 

				//Delete Selected
				$("#btnCheckedYes").on('click',()=>{

					var record = JSON.parse(sessionStorage.getItem("cartItems"));
					var match = JSON.parse(delMatch);

					var count = Object.keys(match).length;

					// for(let i = 0; i < count; i++){
					// 	var locate = false;

					// 	for(x in record){
							
					// 		if(x == match[i]){
					// 			delete record[x];
					// 			locate = true;
					// 		}

					// 		if(locate) break;
					// 	}
					// }

					for(let i = 0; i < count; i++){
						var locate = false;

						for(let k = 0; k < record.length; k++){
							
							if(record[k].id == match[i]){
								record.splice(k,1);
								locate = true;
							}

							if(locate) break;
						}
					}

					// var empty = JSON.stringify({});
					var empty = JSON.stringify([]);

					var data = JSON.stringify(record);
					if(data == empty){data = null};
					sessionStorage.setItem("cartItems",data);
					
					location.reload(); 
				})

				//Delete All
				$("#btnClearYes").on('click',()=>{
					sessionStorage.setItem('cartItems',null);
					
					location.reload(); 
				})

				$("#btnPayment").on('click', ()=>{
					let code = "";
					let record = JSON.parse(sessionStorage.getItem("cartItems"));

					// for (x in record) code += x + ":" + record[x][2] + ";";
					for (let i = 0; i < record.length; i++) code += record[i].id + ":" + record[i].count + ";";

					$(".g-form").show();
					$("span#code").html(code);
				});
			}else{
				$("#emptyTable").show();
				$("#deleteWrapper").hide();
			}
			
		})

		

	</script>
	
	<!--Start of Tawk.to Script-->
	<script type="text/javascript">
		var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
		(function(){
			var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
			s1.async=true;
			s1.src='https://embed.tawk.to/5f58940b4704467e89ed6563/default';
			s1.charset='UTF-8';
			s1.setAttribute('crossorigin','*');
			s0.parentNode.insertBefore(s1,s0);
		})();
	</script>
	<!--End of Tawk.to Script-->
		
</body>

</html>
